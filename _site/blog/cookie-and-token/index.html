<!DOCTYPE html>
<html lang="ko">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <title>JIYUN.ME | 쿠키와 토큰</title>
    
        
    <!-- Post info -->
    <meta property="og:site_name" content="JIYUN.ME">
    <meta property="og:type" content="website" /> 
    <meta property="og:url" content="http://localhost:4000/blog/cookie-and-token/" />
    
    <meta property="og:image" content="http://localhost:4000/blog/cookie-and-token/img/01_2.png">

    <!-- title -->
    <meta property="og:title" content="JIYUN.ME | 쿠키와 토큰">
    
    <!-- description -->
    <meta property="og:description" content="## HTTP가 사용자를 식별하는 방법 ### 1. Http Header 사용자의 이메일 주소, 브라우저 정보, 사용자가 현재 링크를 타고 온 근원 페이지 등의 정보를 헤더에 담는다. ### 2. 클라이언트 IP address..."/>
        
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/uikit.min.css">
    <link rel="stylesheet" href="/assets/css/uikit-width-ex.min.css">
    <link rel="stylesheet" href="/assets/css/ionicons.min.css">
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/css/animations.css">
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/toc.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/js/prettify/skins/github2.css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700%7CLora:400,400i%7CShadows+Into+Light:400" rel="stylesheet" />
    <link rel="shortcut icon" href="/assets/img/favicon_2.ico">
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96635380-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-96635380-1');
    </script>

</head>

    
    <body class="loading">
        

        <!-- NavBar Start -->
        <div class="tw-preloader">
            <div data-uk-spinner></div>
        </div>

        <!-- 
        <div class="header-container tw-header uk-dark">
         -->
        <div class="header-container tw-header tw-header-transparent uk-dark" style="background-color: rgba(255, 255, 255, 0.25);">
        
            <nav class="uk-navbar-container uk-flex-center" data-uk-navbar>

                <!-- NavBar Left Logo Start -->
                <div class="uk-navbar-left">
                    <div class="tw-logo">
                        <h3 class="site-name">
                            <a href="/">JIYUN.ME</a>
                        </h3>
                    </div>
                </div>
                <!-- NavBar Left Logo End -->

                <!-- NavBar Center Menu Start -->
                <div class="uk-navbar-center" id="top">
                    <ul class="tw-main-menu uk-visible@m">
                        <li class="menu-item">
                            <a href="/"  class="normal"  class="active">Home</a>
                        </li>
                        <li class="menu-item">
                            <a href="/projects"  >Projects</a>
                        </li>
                        <li class="menu-item">
                            <a href="/blog"  class="active" >Blog</a>
                        </li>
                        <!-- <li class="menu-item">
                            <a href="/guestbook"  >Guestbook</a>
                        </li> -->
                    </ul>
                </div>
                <!-- NavBar Center Menu End -->

                <!-- NavBar Right Menu Icon Start -->
                <div class="uk-navbar-right">
                    <div class="tw-header-meta">
                        <a class="mobile-menu uk-navbar-toggle uk-hidden@m" href="#" data-uk-toggle="target: #mobile-menu-modal"><i class="ion-navicon-round"></i></a>
                    </div>
                </div>
                <!-- NavBar Right Menu Icon End -->

                <!-- NavBar Right Menu List Start -->
                <div id="mobile-menu-modal" class="uk-modal-full" data-uk-modal>
                    <div class="uk-modal-dialog">
                        <button class="uk-modal-close-full" type="button" data-uk-close></button>
                        <div class="uk-light uk-height-viewport tw-mobile-modal uk-flex uk-flex-middle uk-flex-center" data-uk-scrollspy="target:>ul>li,>div>a; cls:uk-animation-slide-bottom-medium; delay: 150;">
                            <ul class="uk-nav-default" data-uk-nav>
                                <li class="uk-nav-default">
                                    <a href="/"  class="normal"  class="active">Home</a>
                                </li>
                                <li class="uk-nav-default">
                                    <a href="/projects"  >Projects</a>
                                </li>
                                <li class="uk-nav-default">
                                    <a href="/blog"  class="active" >Blog</a>
                                </li>
                                <!-- <li class="uk-nav-default">
                                    <a href="/guestbook"  >Guestbook</a>
                                </li> -->
                            </ul>

                            <div class="tw-socials tw-socials-minimal">
                                <a href="https://github.com/llb1026" target="_blank"><i class="uk-icon-button tw-margin fa fa-github"></i></a>
                                <a href="https://www.linkedin.com/in/jiyun-lee-b19a02153" target="_blank"><i class="uk-icon-button tw-margin fa fa-linkedin"></i></a>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- NavBar Right Menu List End -->

            </nav>
        </div>
        <!-- NavBar End -->
    
        <!-- Content Start -->
        <main>
            <div class="main-container">

    
        <br /><br />
<section class="uk-section-normal uk-section-blog" style="padding-bottom: 0;">
    <div class="uk-container uk-container-small">
        <div data-uk-grid>
            <div class="content-area uk-width-expand">
                <article class="single post">
                    <div class="entry-post">
                        <div class="entry-cats tw-meta">
                            <p>tech-notes</p>
                        </div>
                        <!-- <h2 class="entry-title post-title">
                            <a href="#">쿠키와 토큰</a>
                        </h2> -->
                        <div class="heading-title-article post-title">
                            <h2 class="title">쿠키와 토큰</h2>
                        </div>
                        <div class="entry-date tw-meta">
                            <span>HTTP가 사용자를 식별하는 방법</span>
                        </div>

                        <!-- Blog Content Start -->
                        <div class="post-article">

                            <!-- Title Image Start -->
                            <div class="entry-media uk-padding-small">
                                <div class="tw-thumbnail" data-uk-lightbox>
                                    <img src="img/01_2.png" alt="" />
                                    <div class="image-overlay">
                                        <a href="img/01_2.png"></a>
                                    </div>
                                </div>
                            </div>
                            <!-- Title Image End -->

                            <!-- Scroll Spy TOC Start -->
                            <div class="toc">
                                <a href="#top">&#x1F446; 맨 위로</a>
                                <ul><li><a href="#http가-사용자를-식별하는-방법">HTTP가 사용자를 식별하는 방법</a><ul><li><a href="#1-http-header">1. Http Header</a></li><li><a href="#2-클라이언트-ip-address">2. 클라이언트 IP address</a></li><li><a href="#3-사용자-로그인-인증">3. 사용자 로그인 인증</a></li><li><a href="#4-url에-식별자-포함">4. URL에 식별자 포함</a></li><li><a href="#5-쿠키">5. 쿠키</a></li></ul></li><li><a href="#세션과-쿠키">세션과 쿠키</a></li><li><a href="#토큰과-쿠키">토큰과 쿠키</a><ul><li><a href="#전통적인-쿠키세션을-이용한-로그인-과정">전통적인 쿠키/세션을 이용한 로그인 과정</a></li><li><a href="#jwt-json-web-token-">JWT<sup> JSON Web Token </sup></a></li><li><a href="#토큰을-이용한-로그인-과정">토큰을 이용한 로그인 과정</a></li></ul></li><li><a href="#로컬-스토리지와-세션-스토리지-쿠키">로컬 스토리지와 세션 스토리지, 쿠키</a></li></ul>
                            </div>
                            <!-- Scroll Spy TOC End -->

                            <h2 id="http가-사용자를-식별하는-방법">HTTP가 사용자를 식별하는 방법</h2>

<h3 id="1-http-header">1. Http Header</h3>

<p>사용자의 이메일 주소, 브라우저 정보, 사용자가 현재 링크를 타고 온 근원 페이지 등의 정보를 헤더에 담는다.</p>

<h3 id="2-클라이언트-ip-address">2. 클라이언트 IP address</h3>

<p>웹 초기에 쓰이던 방법이다. 단점으로는 여러 명의 사용자가 같은 컴퓨터를 사용하는 경우 각각의 사용자를 구별할 수 없고, 동적 IP 주소 할당으로 인해 한 사용자가 매번 다른 IP 주소를 사용하게 되는 환경에서는 쓸모가 없다. 또한 프록시가 있는 경우에도 클라이언트의 IP 대신 프록시의 IP를 보아서 식별에 실패한다.</p>

<h3 id="3-사용자-로그인-인증">3. 사용자 로그인 인증</h3>

<p><code class="language-plaintext highlighter-rouge">Authorization Header</code>를 사용해 웹사이트에 사용자 정보를 전달한다.</p>

<h3 id="4-url에-식별자-포함">4. URL에 식별자 포함</h3>

<p>이런 방식을 fat URL이라고 하는데, 단점으로는 URL이 못생겨지고, 특정 사용자의 정보를 포함하고 있기 때문에 공유할 수 없는 URL이 되고, 기존 URL이 달라지기 때문에 캐시를 사용할 수 없고, 사용자가 fat URL에서 이탈하기 쉽고, 세션 간 지속성이 없어진다는 점이 있다.</p>

<h3 id="5-쿠키">5. 쿠키</h3>

<p>쿠키는 크게 <strong>세션 쿠키</strong>와 <strong>지속 쿠키</strong>로 나눌 수 있다.</p>

<p>세션 쿠키는 사용자가 사이트를 탐색할 때, 관련된 설정과 선호 사항들을 저장하는 임시 쿠키이다. 세션 쿠키는 사용자가 브라우저를 닫으면 삭제된다. 지속 쿠키는 삭제되지 않고 더 길게 유지될 수 있다. 지속 쿠키는 디스크에 저장되어 브라우저를 닫거나 컴퓨터를 재시작하더라도 남아있다.</p>

<p>둘의 차이는 파기되는 시점 뿐이다. 또한 특별히 쿠키가 캐싱되지 않도록 주의해야 한다.</p>

<hr />

<h2 id="세션과-쿠키">세션과 쿠키</h2>

<p>둘 다 정보를 저장하기 위해 쓰인다. <em>쿠키는 클라이언트측에만 저장</em>되고, <em>세션은 클라이언트와 서버 둘 다에 저장</em>될 수 있다.</p>

<p>세션은 서버에 임시 폴더와 파일을 만든다. 세션으로 저장된 데이터는 사용자가 다른 페이지로 옮겨다녀도 유지된다. 세션 기록은 사용자가 브라우저를 닫거나 사이트를 떠났을 때 끝나고, 서버는 특정 시간이 지난 후 세션을 파기한다. 보통 30분 주기로 이루어진다.</p>

<p>쿠키는 클라이언트 컴퓨터에 저장되는 텍스트 파일이다. 서버측 스크립트는 이름, 나이 등과 같은 쿠키 정보들을 브라우저에 전달하고, 브라우저는 이 정보들을 바탕으로 사용자에게 맞춤 제품 추천, 연관 광고 띄우기 등을 수행한다.</p>

<p>세션과 쿠키를 둘 다 쓸 수 없다면 토큰을 쓰거나 데이터베이스를 써야 한다. 데이터베이스도 쓸 수 없다면 인메모리 캐시를 쓸 수 있을 것이다. 웬만하면 쿠키를 쓸 수 있다면 쿠키를 쓰는 것이 좋다.</p>

<hr />

<h2 id="토큰과-쿠키">토큰과 쿠키</h2>

<h3 id="전통적인-쿠키세션을-이용한-로그인-과정">전통적인 쿠키/세션을 이용한 로그인 과정</h3>

<ol>
  <li>사용자가 아이디와 비밀번호를 입력해 서버에게 로그인 요청을 보낸다.</li>
  <li>서버는 요청받은 정보를 검사하고, 그 값이 정확한지 체크한 후, 문제가 없으면 세션을 만들어 로그인중인 리스트에 해당 유저를 추가하고 클라이언트에게 HTTP 응답코드 200과 함께 요청받은 문서를 보낸다.</li>
  <li>로그인중인 유저를 확인할 때에는 매 요청마다 서버가 세션 저장소에서 세션을 읽은 후, 클라이언트로 응답한다.</li>
</ol>

<h3 id="jwt-json-web-token-">JWT<sup> JSON Web Token </sup></h3>

<p>JWT는 토큰 기반 인증 시스템의 구현체이다.</p>

<p>기존에 서버 측에서 유저들의 정보를 기억하고 있어야 하는 서버 기반 인증은 몇 가지 문제점이 있다. 유저가 로그인을 위해 서버로 인증 요청을 보낼 때, 서버는 이 기록을 세션으로 메모리에 저장해야 한다. 로그인중인 유저의 수가 늘어날 경우 서버에 과부하가 걸릴 수 있다. 이를 피하기 위해서 DB에 세션을 저장할 수도 있지만, 역시 유저 수가 많으면 DB 성능에 무리를 줄 수 있다. 또한 세션 시스템을 사용하면서 서버를 확장하는 것은 매우 까다롭다.</p>

<p>토큰 기반 인증 시스템은 Stateless하다. 유저의 인증 정보를 서버나 세션에 담아두지 않는다. 따라서 서버 확장이 용이하고, 클라이언트가 서버에 요청을 보낼 때 더이상 쿠키를 전달하지 않아도 되고, 쿠키가 여러 도메인에서 작동하도록 추가로 설정할 필요가 없다.</p>

<p>JWT는 웹 표준 RFC 7519에 등록되어있다.</p>

<h3 id="토큰을-이용한-로그인-과정">토큰을 이용한 로그인 과정</h3>

<ol>
  <li>유저가 아이디와 비밀번호로 로그인을 한다.</li>
  <li>서버측에서 해당 계정 정보를 검증하고, 계정 정보가 정확하다면 서버측에서 유저에게 토큰을 발급해준다.</li>
  <li>클라이언트측에서 전달받은 토큰을 저장해두고, 서버에 요청을 할 때마다 해당 토큰을 HTTP Header에 담아 함께 서버에 전달한다.</li>
  <li>서버는 토큰을 검증하고, 요청에 응답한다.</li>
</ol>

<hr />

<h2 id="로컬-스토리지와-세션-스토리지-쿠키">로컬 스토리지와 세션 스토리지, 쿠키</h2>

<p>로컬 스토리지와 세션 스토리지는 HTML5에서 추가된 저장소로, key-value 스토리지의 형태이다.</p>

<p>로컬 스토리지의 데이터는 사용자가 지우지 않는 이상 영구적으로 브라우저에 남아있지만, 세션 스토리지의 데이터는 윈도우나 브라우저 탭을 닫을 때 제거된다. 자동 로그인 등 지속적으로 필요한 데이터는 로컬 스토리지에, 일회성 로그인 정보같은 것들은 세션 스토리지에 저장하면 된다</p>

<p>쿠키는 만료 기한이 있는 key-value 스토리지로, 로컬 스토리지와 세션 스토리지가 나오기 이전부터 서버와 클라이언트 간의 지속적인 데이터 교환을 위해 만들어졌다.</p>

<p>쿠키보다 로컬 스토리지가 더 좋은 성능을 보인다. 쿠키는 매 HTTP 요청마다 Request Header에 포함되어 서버에 전달되는데, 매번 필요하지 않은 데이터가 전달되는 것은 낭비이다. 로컬 스토리지는 쿠키와 다르게 용량이 크며, HTTP 요청 때 전달되지 않고, 보안을 강화할 수 있다.</p>

<p>쿠키는 보통 <code class="language-plaintext highlighter-rouge">setCookie()</code>, <code class="language-plaintext highlighter-rouge">getCookie()</code> 함수 안에서 <code class="language-plaintext highlighter-rouge">document.cookie</code>를 사용하고, 스토리지는 <code class="language-plaintext highlighter-rouge">localStorage.setItem()</code>, <code class="language-plaintext highlighter-rouge">getItem()</code>, <code class="language-plaintext highlighter-rouge">remove()</code>, <code class="language-plaintext highlighter-rouge">clear()</code> 등의 함수를 사용한다.</p>


                        </div>
                        <!-- Blog Content Start -->
                    </div>
                </article>
            </div>
        </div>
    </div>
</section>

<!-- Pagination Start -->
<section class="uk-section uk-section-small">
    <div class="uk-container uk-container-small">
        <div class="tw-portfolio-nav uk-flex uk-flex-between uk-flex-middle">
            
            <div class="nav-prev tw-meta">
                <a href="../webrtc-intro/">
                    <i class="ion-ios-arrow-left"></i>
                    <span>Prev</span>
                </a>
            </div>
            
            <div class="nav-link">
                <a href="/blog">
                    <i class="ion-grid"></i>
                </a>
            </div>
            
            <div class="nav-next tw-meta">
                <a href="../nginx-tuning/">
                    <span>Next</span>
                    <i class="ion-ios-arrow-right"></i>
                </a>
            </div>
            
        </div>
    </div>
</section>
<!-- Pagination End -->


<script>
    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3";
        });
        return headerNodes;
    }
  
    var title = document.getElementsByClassName("post-title")[0];
    var titleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var article = document.getElementsByClassName("post-article")[0];
    var articleY = window.pageYOffset + article.getBoundingClientRect().top;
  
    var toc = document.getElementsByClassName("toc")[0];
  
    var headerNodes = getHeaderNodes(article);
    var tocNodes = getTOCNodes(toc);
  
    var before = undefined;
  
    document.addEventListener('scroll', function(e) {
        if (window.scrollY >= articleY - 60) {
            toc.style.cssText = "position: fixed; top: 60px;";
        }
        else {
            toc.style.cssText = "";
        }
    
        var current = headerNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 200;
        });
  
        if (current.length > 0) {
            current = current[current.length-1];
    
            var currentA = tocNodes.filter(function(tocNode) {
                return tocNode.innerHTML == current.innerHTML;
            })
            
            currentA = currentA[0];
            if (currentA) {
                if (before == undefined) before = currentA;
        
                if (before != currentA) {
                    before.classList.remove("toc-active");
                    before = currentA;
                }
        
                currentA.classList.add("toc-active");
            }
            else {
                if (before) 
                    before.classList.remove("toc-active");
            }
        }
        else {
            if (before) 
                before.classList.remove("toc-active");
        }
    }, false);
</script>

    
    
</div>


        </main>
        <!-- Content End -->
      
        <footer class="uk-section uk-padding-remove-vertical uk-light">
    <div class="footer-area footer-small">
        <div class="uk-container">
            <div class="uk-flex-middle uk-child-width-1-3" data-uk-grid>
                <div class="tw-element tw-socials tw-no-bg with-hover">
                    <a href="https://github.com/llb1026" target="_blank"><i class="uk-icon-button tw-margin fa fa-github"></i></a>
                    <a href="https://www.linkedin.com/in/jiyun-lee-b19a02153" target="_blank"><i class="uk-icon-button tw-margin fa fa-linkedin"></i></a>
                </div>
                <div class="uk-text-center copyright">
                    © JIYUN.ME
                </div>
                <div class="uk-text-right">
                    <a href="" data-uk-scroll>Top &nbsp;&nbsp;<i class="ion-ios-arrow-up"></i></a>
                </div>
            </div>
        </div>
    </div>
</footer>

   
        <script src="/assets/js/jquery-3.2.0.min.js"></script>
        <script src="/assets/js/jquery.easypiechart.min.js"></script>
        <script src="/assets/js/uikit.min.js"></script>
        <script src="/assets/js/uikit-icons.min.js"></script>
        <script src="/assets/js/isotope.pkgd.min.js"></script>
        <script src="/assets/js/owl.carousel.min.js"></script>
        <script src="/assets/js/theme.js"></script>
        

        <!-- Google Analytics Start -->

        <!-- Google Analytics End -->

    </body>
</html>
