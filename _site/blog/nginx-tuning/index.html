<!DOCTYPE html>
<html lang="ko">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <title>JIYUN.ME | 혼자 해 본 nginx.conf 튜닝</title>
    
        
    <!-- Post info -->
    <meta property="og:site_name" content="JIYUN.ME">
    <meta property="og:type" content="website" /> 
    <meta property="og:url" content="http://localhost:4000/blog/nginx-tuning/" />
    
    <meta property="og:image" content="http://localhost:4000/blog/nginx-tuning/img/01_1.png">

    <!-- title -->
    <meta property="og:title" content="JIYUN.ME | 혼자 해 본 nginx.conf 튜닝">
    
    <!-- description -->
    <meta property="og:description" content="## 1. 프론트엔드 최적화 포인트 ### 1-1. Static한 콘텐츠 캐싱 Nginx에서의 캐싱은 아래와 같이 동작한다. 1. Nginx가 static 리소스 요청을 받음 2. 요청받은 URL을 key로 해당 리소스가 캐시되어 있는지 확인..."/>
        
    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/uikit.min.css">
    <link rel="stylesheet" href="/assets/css/uikit-width-ex.min.css">
    <link rel="stylesheet" href="/assets/css/ionicons.min.css">
    <link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/css/animations.css">
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="/assets/css/toc.css">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/js/prettify/skins/github2.css">
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700%7CLora:400,400i%7CShadows+Into+Light:400" rel="stylesheet" />
    <link rel="shortcut icon" href="/assets/img/favicon_2.ico">
    

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96635380-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-96635380-1');
    </script>

</head>

    
    <body class="loading">
        

        <!-- NavBar Start -->
        <div class="tw-preloader">
            <div data-uk-spinner></div>
        </div>

        <!-- 
        <div class="header-container tw-header uk-dark">
         -->
        <div class="header-container tw-header tw-header-transparent uk-dark" style="background-color: rgba(255, 255, 255, 0.25);">
        
            <nav class="uk-navbar-container uk-flex-center" data-uk-navbar>

                <!-- NavBar Left Logo Start -->
                <div class="uk-navbar-left">
                    <div class="tw-logo">
                        <h3 class="site-name">
                            <a href="/">JIYUN.ME</a>
                        </h3>
                    </div>
                </div>
                <!-- NavBar Left Logo End -->

                <!-- NavBar Center Menu Start -->
                <div class="uk-navbar-center" id="top">
                    <ul class="tw-main-menu uk-visible@m">
                        <li class="menu-item">
                            <a href="/"  class="normal"  class="active">Home</a>
                        </li>
                        <li class="menu-item">
                            <a href="/projects"  >Projects</a>
                        </li>
                        <li class="menu-item">
                            <a href="/blog"  class="active" >Blog</a>
                        </li>
                        <!-- <li class="menu-item">
                            <a href="/guestbook"  >Guestbook</a>
                        </li> -->
                    </ul>
                </div>
                <!-- NavBar Center Menu End -->

                <!-- NavBar Right Menu Icon Start -->
                <div class="uk-navbar-right">
                    <div class="tw-header-meta">
                        <a class="mobile-menu uk-navbar-toggle uk-hidden@m" href="#" data-uk-toggle="target: #mobile-menu-modal"><i class="ion-navicon-round"></i></a>
                    </div>
                </div>
                <!-- NavBar Right Menu Icon End -->

                <!-- NavBar Right Menu List Start -->
                <div id="mobile-menu-modal" class="uk-modal-full" data-uk-modal>
                    <div class="uk-modal-dialog">
                        <button class="uk-modal-close-full" type="button" data-uk-close></button>
                        <div class="uk-light uk-height-viewport tw-mobile-modal uk-flex uk-flex-middle uk-flex-center" data-uk-scrollspy="target:>ul>li,>div>a; cls:uk-animation-slide-bottom-medium; delay: 150;">
                            <ul class="uk-nav-default" data-uk-nav>
                                <li class="uk-nav-default">
                                    <a href="/"  class="normal"  class="active">Home</a>
                                </li>
                                <li class="uk-nav-default">
                                    <a href="/projects"  >Projects</a>
                                </li>
                                <li class="uk-nav-default">
                                    <a href="/blog"  class="active" >Blog</a>
                                </li>
                                <!-- <li class="uk-nav-default">
                                    <a href="/guestbook"  >Guestbook</a>
                                </li> -->
                            </ul>

                            <div class="tw-socials tw-socials-minimal">
                                <a href="https://github.com/llb1026" target="_blank"><i class="uk-icon-button tw-margin fa fa-github"></i></a>
                                <a href="https://www.linkedin.com/in/jiyun-lee-b19a02153" target="_blank"><i class="uk-icon-button tw-margin fa fa-linkedin"></i></a>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- NavBar Right Menu List End -->

            </nav>
        </div>
        <!-- NavBar End -->
    
        <!-- Content Start -->
        <main>
            <div class="main-container">

    
        <br /><br />
<section class="uk-section-normal uk-section-blog" style="padding-bottom: 0;">
    <div class="uk-container uk-container-small">
        <div data-uk-grid>
            <div class="content-area uk-width-expand">
                <article class="single post">
                    <div class="entry-post">
                        <div class="entry-cats tw-meta">
                            <p>lesson-learned</p>
                        </div>
                        <!-- <h2 class="entry-title post-title">
                            <a href="#">혼자 해 본 nginx.conf 튜닝</a>
                        </h2> -->
                        <div class="heading-title-article post-title">
                            <h2 class="title">혼자 해 본 nginx.conf 튜닝</h2>
                        </div>
                        <div class="entry-date tw-meta">
                            <span>프론트엔드 최적화 포인트와 간단한 성능테스트 결과</span>
                        </div>

                        <!-- Blog Content Start -->
                        <div class="post-article">

                            <!-- Title Image Start -->
                            <div class="entry-media uk-padding-small">
                                <div class="tw-thumbnail" data-uk-lightbox>
                                    <img src="img/01_1.png" alt="" />
                                    <div class="image-overlay">
                                        <a href="img/01_1.png"></a>
                                    </div>
                                </div>
                            </div>
                            <!-- Title Image End -->

                            <!-- Scroll Spy TOC Start -->
                            <div class="toc">
                                <a href="#top">&#x1F446; 맨 위로</a>
                                <ul><li><a href="#1-프론트엔드-최적화-포인트">1. 프론트엔드 최적화 포인트</a><ul><li><a href="#1-1-static한-콘텐츠-캐싱">1-1. Static한 콘텐츠 캐싱</a></li><li><a href="#1-2-nginx-as-reverse-proxy">1-2. Nginx as reverse proxy</a></li><li><a href="#1-3-nginx-micro-caching">1-3. Nginx micro caching</a></li><li><a href="#1-4-gzip">1-4. gzip</a></li><li><a href="#1-5-최종-nginxconf">1-5. 최종 nginx.conf</a></li></ul></li><li><a href="#2-성능테스트">2. 성능테스트</a><ul><li><a href="#2-1-테스트-환경">2-1. 테스트 환경</a></li><li><a href="#2-2-결과">2-2. 결과</a></li></ul></li></ul>
                            </div>
                            <!-- Scroll Spy TOC End -->

                            <h2 id="1-프론트엔드-최적화-포인트">1. 프론트엔드 최적화 포인트</h2>

<h3 id="1-1-static한-콘텐츠-캐싱">1-1. Static한 콘텐츠 캐싱</h3>

<p>Nginx에서의 캐싱은 아래와 같이 동작한다.</p>

<ol>
  <li>Nginx가 static 리소스 요청을 받음</li>
  <li>요청받은 URL을 key로 해당 리소스가 캐시되어 있는지 확인</li>
  <li>첫 요청이므로 캐시 miss</li>
  <li>WAS로 요청을 보냄</li>
  <li>WAS로부터 응답을 받으면 캐싱할지 검사</li>
  <li>응답을 디스크에 저장해 캐싱</li>
  <li>다음번부터 같은 URL로 요청이 들어오면 캐시 hit, 해당 요청은 WAS로 전달되지 않고 Nginx가 대신 응답을 돌려줌</li>
</ol>

<h3 id="1-2-nginx-as-reverse-proxy">1-2. Nginx as reverse proxy</h3>

<p>Nginx가 reverse proxy로 동작하는 경우, static 리소스는 Nginx에서 캐싱해서 제공하고 dynamic 리소스는 proxy_pass를 통해 받은 요청을 upstream에 정의된 WAS로 넘긴다. 이렇게 구성할 경우 이점은 다음과 같다.</p>

<ul>
  <li><strong>로드밸런싱</strong>
    <ul>
      <li>Nginx가 받은 요청을 여러 WAS로 분산시켜 보낼 수 있다.</li>
    </ul>
  </li>
  <li><strong>요청 선 처리</strong>
    <ul>
      <li>WAS까지 요청이 가기 전에 필요한 선처리를 간단한 설정으로 구현할 수 있다.</li>
      <li>예를 들어, client validation을 위해 HTTP header의 user-agent나 referer를 검사하는 작업을 WAS에서 수행하려면 header 추출하고 비교하는 로직을 직접 구현해야 한다.</li>
    </ul>
  </li>
  <li><strong>static 리소스의 빠른 응답</strong>
    <ul>
      <li>WAS까지 가는 요청이 줄어든다.</li>
      <li>Nginx나 Apache같은 전용 웹서버는 파일 읽기 연산에 최적화되어 있어서 WAS가 수행하는 것보다 빠르고 효율적으로 동작한다.</li>
      <li>static 리소스와 dynamic 리소스를 분리해 처리함으로써 최적화가 쉬워진다.</li>
    </ul>
  </li>
</ul>

<h3 id="1-3-nginx-micro-caching">1-3. Nginx micro caching</h3>

<p>micro caching은 WAS로 요청하는 dynamic 리소스에 대해 아주 짧은 시간동안 캐싱을 해서 WAS로 보내는 요청을 줄이는 방법이다. 사실 dynamic 리소스라고 하더라도 초단위로 페이지가 업데이트되는 경우는 드물어서, 1초라도 캐싱을 해 두면 많은 트래픽의 요청을 효과적으로 처리할 수 있게 된다.</p>

<p>기본적인 reverse proxy로 설정된 데에 micro caching을 추가한 설정은 다음과 같다.</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nginx.conf
</span>
<span class="n">proxy_cache_path</span> /<span class="n">tmp</span>/<span class="n">cache</span>             // 캐시 파일이 로컬에 저장될 위치 설정
                 <span class="n">levels</span>=<span class="m">1</span>:<span class="m">2</span>             // 캐시 파일을 어떻게 저장할지 결정 (첫번째 <span class="n">depth</span>의 디렉토리 이름은 <span class="m">1</span>글자, 두번째 <span class="n">depth</span>의 디렉토리 이름은 <span class="m">2</span>글자로 하겠다고 명시)
                 <span class="n">keys_zone</span>=<span class="n">my_cache</span>:<span class="m">10</span><span class="n">m</span> // 캐시 이름 할당
                 <span class="n">inactive</span>=<span class="m">600</span><span class="n">s</span>          // 일정 시간동안 사용되지 않은 캐시 파일은 삭제하도록 설정
                 <span class="n">max_size</span>=<span class="m">1</span><span class="n">g</span>;           // 캐시 파일의 최대 크기 지정

<span class="n">server</span> {
    <span class="n">listen</span> <span class="m">80</span>;
    <span class="n">server_name</span> <span class="n">localhost</span>;

    <span class="n">location</span> / {
        <span class="n">proxy_cache</span> <span class="n">my_cache</span>;           // 사용할 캐시 지정
        <span class="n">proxy_cache_valid</span> <span class="m">200</span> <span class="m">1</span><span class="n">s</span>;       // <span class="m">1</span>초동안 <span class="n">micro</span> <span class="n">caching</span>
        <span class="n">add_header</span> <span class="n">X</span>-<span class="n">Proxy</span>-<span class="n">Cache</span> $<span class="n">upstream_cache_status</span>;  // 캐시 <span class="n">HIT</span>, <span class="n">MISS</span>, <span class="n">MYPASS</span>와 같은 캐시 적중 상태정보 표시

        <span class="n">proxy_http_version</span> <span class="m">1</span>.<span class="m">1</span>;
        <span class="n">proxy_set_header</span> <span class="n">Connection</span> <span class="s2">""</span>;
        ...
    }
}
</code></pre></div></div>

<p>단, micro caching을 도입하기 전에 고려해야 할 사항들이 있다.</p>

<ul>
  <li>dynamic 리소스를 캐싱을 통해 제공하는 것보다 WAS에서 받는 것이 더 빠른 경우도 있다. 이러면 micro caching이 오히려 더 낮은 성능을 내는 요인이 될 수 있다.</li>
  <li>dynamic 리소스가 1초(혹은 개별적으로 정한 micro 단위시간)동안 캐싱되어서 내용이 변경되지 않아도 서비스에 영향이 없는지 확실한 검증이 필요하다.</li>
</ul>

<h3 id="1-4-gzip">1-4. gzip</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">gzip_comp_level</code>: 1~9까지 설정 가능, 숫자가 클수록 압축률은 올라가지만 압축 속도는 느려짐</li>
  <li><code class="language-plaintext highlighter-rouge">gzip_min_length</code>: 압축을 적용할 컨텐츠의 최소 사이즈 지정, 이보다 작은 파일은 압축하지 않음</li>
  <li><code class="language-plaintext highlighter-rouge">gzip_buffers</code>: 버퍼의 숫자와 크기 지정</li>
  <li><code class="language-plaintext highlighter-rouge">gzip proxyed</code>: proxy나 캐시 서버에서 요청할 경우 동작 여부 설정
    <ul>
      <li><code class="language-plaintext highlighter-rouge">off</code>: proxy에서 요청할 경우 압축하지 않음</li>
      <li><code class="language-plaintext highlighter-rouge">expired</code>: 요청 header에 Expires가 있고 만료되었을 경우에만 압축</li>
      <li><code class="language-plaintext highlighter-rouge">no-cache</code>: 요청 header에 Cache-Control이 있고 no-cache일 경우에만 압축</li>
      <li><code class="language-plaintext highlighter-rouge">no-store</code>: 요청 header에 Cache-Control이 있고 no-store일 경우에만 압축</li>
      <li><code class="language-plaintext highlighter-rouge">any</code>: 항상 압축</li>
    </ul>
  </li>
</ul>

<h3 id="1-5-최종-nginxconf">1-5. 최종 nginx.conf</h3>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">user</span> <span class="n">nginx</span>;
<span class="n">worker_processes</span> <span class="n">auto</span>;
<span class="n">error_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>-<span class="n">error</span>.<span class="n">log</span>;
<span class="n">pid</span> /<span class="n">run</span>/<span class="n">nginx</span>.<span class="n">pid</span>;

<span class="c"># Load dynamic modules. See /usr/share/nginx/README.dynamic.
</span><span class="n">include</span> /<span class="n">usr</span>/<span class="n">share</span>/<span class="n">nginx</span>/<span class="n">modules</span>/*.<span class="n">conf</span>;

<span class="n">events</span> {
    <span class="n">use</span> <span class="n">epoll</span>;  <span class="c"># epoll은 Linux에서 socket을 관리하는 데 사용하는 방식 중 하나로, poll과 select가 해당 프로세스에 연결된 모든 connection file을 스캔하는 데에 비해 epoll은 수천개의 file descriptor를 처리할 수 있도록 보다 효율적인 알고리즘을 사용해 대량 요청이 발생하는 시스템에 적합하다
</span>    <span class="n">worker_connections</span> <span class="m">1024</span>;
}

<span class="n">http</span> {
    <span class="n">log_format</span>  <span class="n">main</span>  <span class="s1">'$remote_addr - $remote_user [$time_local] "$request" '</span>
                      <span class="s1">'$status $body_bytes_sent "$http_referer" '</span>
                      <span class="s1">'"$http_user_agent" "$http_x_forwarded_for"'</span>;

    <span class="c"># HDD의 IO 성능을 향상시키기 위해 보통 off로 두지만, 개발하면서 볼 용도로 켜놓음
</span>    <span class="n">access_log</span>  /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>-<span class="n">access</span>.<span class="n">log</span> <span class="n">main</span>;

    <span class="c"># 파일의 메타 데이터 정보를 캐시한다 (파일 컨텐츠가 아니라 메타 데이터!) 트래픽이 많을 경우 퍼포먼스 향상 효과를 크게 볼 수 있다
</span>    <span class="n">open_file_cache</span>             <span class="n">max</span>=<span class="m">200000</span> <span class="n">inactive</span>=<span class="m">20</span><span class="n">s</span>;
    <span class="n">open_file_cache_valid</span>       <span class="m">30</span><span class="n">s</span>;
    <span class="n">open_file_cache_min_uses</span>    <span class="m">2</span>;
    <span class="n">open_file_cache_errors</span>      <span class="n">on</span>;

    <span class="c"># 파일을 압축 설정 (네트워크를 통해 전송되는 데이터 크기를 줄이기 위함)
</span>    <span class="n">gzip</span>                <span class="n">on</span>;
    <span class="n">gzip_comp_level</span>     <span class="m">9</span>;
    <span class="n">gzip_min_length</span>     <span class="m">10240</span>;
    <span class="n">gzip_proxied</span>        <span class="n">any</span>;
    <span class="n">gzip_types</span>          <span class="n">text</span>/<span class="n">plain</span>
                        <span class="n">text</span>/<span class="n">css</span>
                        <span class="n">text</span>/<span class="n">js</span>
                        <span class="n">text</span>/<span class="n">xml</span>
                        <span class="n">text</span>/<span class="n">javascript</span>
                        <span class="n">application</span>/<span class="n">javascript</span>
                        <span class="n">applicaion</span>/<span class="n">x</span>-<span class="n">javascript</span>
                        <span class="n">application</span>/<span class="n">json</span>
                        <span class="n">applicatoin</span>/<span class="n">xml</span>
                        <span class="n">application</span>/<span class="n">rss</span>+<span class="n">xml</span>
                        <span class="n">image</span>/<span class="n">svg</span>+<span class="n">xml</span>;

    <span class="n">sendfile</span>                    <span class="n">on</span>;  <span class="c"># 응답을 보낼 때 user-space의 buffer 메모리를 쓰지 않고 바로 kernel file buffer를 사용해 더 빠르다
</span>    <span class="n">reset_timedout_connection</span>   <span class="n">on</span>;  <span class="c"># timeout 이후 바로 메모리에 남아있는 데이터를 삭제해 메모리 공간 확보
</span>    <span class="n">client_body_timeout</span>         <span class="m">10</span>;  <span class="c"># 요청 타임아웃 (디폴트 60)
</span>    <span class="n">send_timeout</span>                <span class="m">2</span>;   <span class="c"># 클라이언트 측에서 응답이 없으면 메모리 free (디폴트 60)
</span>    <span class="n">keepalive_timeout</span>           <span class="m">30</span>;  <span class="c"># 해당 시간 이후 서버가 커넥션을 닫음 (디폴트 75)
</span>    <span class="n">keepalive_requests</span>          <span class="m">100000</span>;   <span class="c"># keep-alive동안 클라이언트가 보낼 수 있는 요청 개수
</span>
    <span class="n">include</span>             /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">mime</span>.<span class="n">types</span>;
    <span class="n">default_type</span>        <span class="n">application</span>/<span class="n">octet</span>-<span class="n">stream</span>;

    <span class="c"># 로컬 캐시 설정
</span>    <span class="n">proxy_cache_path</span>    /<span class="n">var</span>/<span class="n">cache</span>/<span class="n">nginx</span>  <span class="c"># 캐시 파일이 저장될 경로
</span>                        <span class="n">levels</span>=<span class="m">1</span>:<span class="m">2</span>  <span class="c"># 캐시 파일을 어떻게 저장할지 결정 (첫번째 depth의 디렉토리 이름은 1글자, 두번째 depth의 디렉토리 이름은 2글자로 하겠다고 명시)
</span>                        <span class="n">keys_zone</span>=<span class="n">nginx_cache</span>:<span class="m">1</span><span class="n">m</span>  <span class="c"># 캐시 이름
</span>                        <span class="n">max_size</span>=<span class="m">10</span><span class="n">g</span>  <span class="c"># 캐시 파일의 최대 크기 지정
</span>                        <span class="n">inactive</span>=<span class="m">60</span><span class="n">s</span>  <span class="c"># 일정 시간동안 사용되지 않은 캐시 파일은 삭제하도록 설정
</span>                        <span class="n">use_temp_path</span>=<span class="n">off</span>;  <span class="c"># 불필요한 카피 데이터들이 임시 공간에 저장되는 것을 방지
</span>
    <span class="c"># Load modular configuration files from the /etc/nginx/conf.d directory.
</span>    <span class="c"># See http://nginx.org/en/docs/ngx_core_module.html#include
</span>    <span class="c"># for more information.
</span>    <span class="n">include</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">conf</span>.<span class="n">d</span>/*.<span class="n">conf</span>;

    <span class="n">server</span> {
        <span class="n">listen</span>       <span class="m">80</span> <span class="n">default_server</span>;
        <span class="n">listen</span>       [::]:<span class="m">80</span> <span class="n">default_server</span>;
        <span class="n">root</span>         /<span class="n">home1</span>/<span class="n">irteam</span>/<span class="n">deploy</span>/<span class="n">internship</span>/<span class="n">frontend</span>/<span class="n">build</span>;
        <span class="n">index</span>        <span class="n">index</span>.<span class="n">html</span> <span class="n">index</span>.<span class="n">htm</span>;

        <span class="c"># Load configuration files for the default server block.
</span>        <span class="n">include</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">default</span>.<span class="n">d</span>/*.<span class="n">conf</span>;

        <span class="n">proxy_cache</span> <span class="n">nginx_cache</span>;
        <span class="n">proxy_cache_revalidate</span> <span class="n">on</span>;
        <span class="n">proxy_cache_lock</span> <span class="n">on</span>;
        <span class="n">proxy_cache_key</span> $<span class="n">host</span>$<span class="n">uri</span>;
        <span class="n">proxy_cache_valid</span> <span class="m">200</span> <span class="m">1</span><span class="n">m</span>;
        <span class="n">proxy_cache_use_stale</span> <span class="n">error</span> <span class="n">timeout</span> <span class="n">http_500</span> <span class="n">http_502</span> <span class="n">http_503</span> <span class="n">http_504</span>;
        <span class="n">add_header</span> <span class="n">X</span>-<span class="n">Cache</span>-<span class="n">Status</span> $<span class="n">upstream_cache_status</span>;

        <span class="n">location</span> / {
            <span class="n">root</span> /<span class="n">home1</span>/<span class="n">irteam</span>/<span class="n">deploy</span>/<span class="n">internship</span>/<span class="n">frontend</span>/<span class="n">build</span>;
            <span class="n">try_files</span> $<span class="n">uri</span> /<span class="n">index</span>.<span class="n">html</span>;
        }

        <span class="n">location</span> /<span class="n">api</span> {
            <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">10</span>.<span class="m">105</span>.<span class="m">188</span>.<span class="m">47</span>:<span class="m">8080</span>;
            <span class="n">charset</span> <span class="n">utf</span>-<span class="m">8</span>;

            <span class="n">proxy_http_version</span> <span class="m">1</span>.<span class="m">1</span>;
            <span class="n">proxy_set_header</span> <span class="n">Upgrade</span> $<span class="n">http_upgrade</span>;
            <span class="n">proxy_set_header</span> <span class="n">Connection</span> <span class="s2">"upgrade"</span>;
            <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">host</span>;
        }

        <span class="n">location</span> ~* \.(?:<span class="n">manifest</span>|<span class="n">appcache</span>|<span class="n">html</span>?|<span class="n">xml</span>)$ {
            <span class="n">expires</span> -<span class="m">1</span>;
        }

        <span class="n">location</span> ~* \.(?:<span class="n">jpg</span>|<span class="n">jpeg</span>|<span class="n">gif</span>|<span class="n">png</span>|<span class="n">ico</span>|<span class="n">cur</span>|<span class="n">gz</span>|<span class="n">svg</span>|<span class="n">svgz</span>|<span class="n">mp4</span>|<span class="n">ogg</span>|<span class="n">ogv</span>|<span class="n">webm</span>|<span class="n">htc</span>)$ {
            <span class="n">expires</span> <span class="m">1</span><span class="n">M</span>;
            <span class="n">access_log</span> <span class="n">off</span>;
            <span class="n">add_header</span> <span class="n">Cache</span>-<span class="n">Control</span> <span class="s2">"public"</span>;
        }

        <span class="n">location</span> ~* \.(?:<span class="n">css</span>|<span class="n">js</span>)$ {
            <span class="n">expires</span> <span class="m">1</span><span class="n">y</span>;
            <span class="n">access_log</span> <span class="n">off</span>;
            <span class="n">add_header</span> <span class="n">Cache</span>-<span class="n">Control</span> <span class="s2">"public"</span>;
        }

        <span class="n">error_page</span> <span class="m">400</span> <span class="m">401</span> <span class="m">403</span> <span class="m">404</span> /<span class="m">404</span>.<span class="n">html</span>;
            <span class="n">location</span> = /<span class="m">40</span><span class="n">x</span>.<span class="n">html</span> {
        }

        <span class="n">error_page</span> <span class="m">500</span> <span class="m">501</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span> /<span class="m">50</span><span class="n">x</span>.<span class="n">html</span>;
            <span class="n">location</span> = /<span class="m">50</span><span class="n">x</span>.<span class="n">html</span> {
        }
    }
}
</code></pre></div></div>

<hr />

<h2 id="2-성능테스트">2. 성능테스트</h2>

<p>네이버 사내 프론트엔드 테스트 툴을 사용해 개발한 어플리케이션 성능테스트를 돌려보았다.</p>

<h3 id="2-1-테스트-환경">2-1. 테스트 환경</h3>

<ul>
  <li>기사 수: 12개</li>
  <li>캐시: off</li>
  <li>에이전트: Chrome_WIN10_I7</li>
  <li>네트워크 환경: FTTH(100M) - 2ms, 91Mbps, 94Mbps</li>
</ul>

<h3 id="2-2-결과">2-2. 결과</h3>

<table class="uk-table-small uk-table style-2 uk-table-striped uk-text-center">
    <thead>
        <tr>
            <th style="text-align: center;"> \ </th>
            <th style="text-align: center;">최적화 이전</th>
            <th style="text-align: center;">최적화 이후</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><em>Time To First Byte</em></td>
            <td>17ms</td>
            <td>21ms</td>
        </tr>
        <tr>
            <td><em>Start Render</em></td>
            <td>600ms</td>
            <td>400ms</td>
        </tr>
        <tr>
            <td><em>Load Time</em></td>
            <td>580ms</td>
            <td>457ms</td>
        </tr>
        <tr>
            <td><em>Speed Index</em></td>
            <td>651ms</td>
            <td>448ms</td>
        </tr>
        <tr>
            <td><em>Visually Complete</em></td>
            <td>700ms</td>
            <td>500ms</td>
        </tr>
        <tr>
            <td><em>전체 로드한 크기</em></td>
            <td>849.8KB</td>
            <td>400.5KB</td>
        </tr>
        <tr>
            <td><em>요주의 리소스</em></td>
            <td>`0.chunk.js`: 509.8KB, <br />`main.chunk.js`: 130.5KB</td>
            <td>`0.chunk.js`: 73.1KB, <br />`main.chunk.js`: 3.7KB</td>
        </tr>
    </tbody>
</table>


                        </div>
                        <!-- Blog Content Start -->
                    </div>
                </article>
            </div>
        </div>
    </div>
</section>

<!-- Pagination Start -->
<section class="uk-section uk-section-small">
    <div class="uk-container uk-container-small">
        <div class="tw-portfolio-nav uk-flex uk-flex-between uk-flex-middle">
            
            <div class="nav-prev tw-meta">
                <a href="../cookie-and-token/">
                    <i class="ion-ios-arrow-left"></i>
                    <span>Prev</span>
                </a>
            </div>
            
            <div class="nav-link">
                <a href="/blog">
                    <i class="ion-grid"></i>
                </a>
            </div>
            
            <div class="nav-next tw-meta">
                <a href="../http-1.1-vs-2.0/">
                    <span>Next</span>
                    <i class="ion-ios-arrow-right"></i>
                </a>
            </div>
            
        </div>
    </div>
</section>
<!-- Pagination End -->


<script>
    function getTOCNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var tocNodes = nodes.filter(function(elem) {
            return elem.tagName == "A";
        });
        return tocNodes;
    }
    function getHeaderNodes(master) {
        var nodes = Array.prototype.slice.call(master.getElementsByTagName("*"), 0);
        var headerNodes = nodes.filter(function(elem) {
            return elem.tagName == "H1" || elem.tagName == "H2" || elem.tagName == "H3";
        });
        return headerNodes;
    }
  
    var title = document.getElementsByClassName("post-title")[0];
    var titleY = window.pageYOffset + title.getBoundingClientRect().top;
    
    var article = document.getElementsByClassName("post-article")[0];
    var articleY = window.pageYOffset + article.getBoundingClientRect().top;
  
    var toc = document.getElementsByClassName("toc")[0];
  
    var headerNodes = getHeaderNodes(article);
    var tocNodes = getTOCNodes(toc);
  
    var before = undefined;
  
    document.addEventListener('scroll', function(e) {
        if (window.scrollY >= articleY - 60) {
            toc.style.cssText = "position: fixed; top: 60px;";
        }
        else {
            toc.style.cssText = "";
        }
    
        var current = headerNodes.filter(function(header) {
            var headerY = window.pageYOffset + header.getBoundingClientRect().top;
            return window.scrollY >= headerY - 200;
        });
  
        if (current.length > 0) {
            current = current[current.length-1];
    
            var currentA = tocNodes.filter(function(tocNode) {
                return tocNode.innerHTML == current.innerHTML;
            })
            
            currentA = currentA[0];
            if (currentA) {
                if (before == undefined) before = currentA;
        
                if (before != currentA) {
                    before.classList.remove("toc-active");
                    before = currentA;
                }
        
                currentA.classList.add("toc-active");
            }
            else {
                if (before) 
                    before.classList.remove("toc-active");
            }
        }
        else {
            if (before) 
                before.classList.remove("toc-active");
        }
    }, false);
</script>

    
    
</div>


        </main>
        <!-- Content End -->
      
        <footer class="uk-section uk-padding-remove-vertical uk-light">
    <div class="footer-area footer-small">
        <div class="uk-container">
            <div class="uk-flex-middle uk-child-width-1-3" data-uk-grid>
                <div class="tw-element tw-socials tw-no-bg with-hover">
                    <a href="https://github.com/llb1026" target="_blank"><i class="uk-icon-button tw-margin fa fa-github"></i></a>
                    <a href="https://www.linkedin.com/in/jiyun-lee-b19a02153" target="_blank"><i class="uk-icon-button tw-margin fa fa-linkedin"></i></a>
                </div>
                <div class="uk-text-center copyright">
                    © JIYUN.ME
                </div>
                <div class="uk-text-right">
                    <a href="" data-uk-scroll>Top &nbsp;&nbsp;<i class="ion-ios-arrow-up"></i></a>
                </div>
            </div>
        </div>
    </div>
</footer>

   
        <script src="/assets/js/jquery-3.2.0.min.js"></script>
        <script src="/assets/js/jquery.easypiechart.min.js"></script>
        <script src="/assets/js/uikit.min.js"></script>
        <script src="/assets/js/uikit-icons.min.js"></script>
        <script src="/assets/js/isotope.pkgd.min.js"></script>
        <script src="/assets/js/owl.carousel.min.js"></script>
        <script src="/assets/js/theme.js"></script>
        

    </body>
</html>
